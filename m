Return-Path: <linux-serial-owner@vger.kernel.org>
X-Original-To: lists+linux-serial@lfdr.de
Delivered-To: lists+linux-serial@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id BF4553ACDFA
	for <lists+linux-serial@lfdr.de>; Fri, 18 Jun 2021 16:52:58 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S234752AbhFROzB (ORCPT <rfc822;lists+linux-serial@lfdr.de>);
        Fri, 18 Jun 2021 10:55:01 -0400
Received: from mout.gmx.net ([212.227.15.15]:50719 "EHLO mout.gmx.net"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S234753AbhFROzB (ORCPT <rfc822;linux-serial@vger.kernel.org>);
        Fri, 18 Jun 2021 10:55:01 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=gmx.net;
        s=badeba3b8450; t=1624027966;
        bh=5KANbDUOSm1uBFlCYYXKIoijReWqt8fXs2haBqiKeDk=;
        h=X-UI-Sender-Class:From:To:Cc:Subject:Date;
        b=MV+R3p/o2RUR7HWu7O/XF6HRNyrXijA4LNhqWkghgdN01r3VXHULGG8wjfUFyr66K
         arkFArj6dUrM9szGqWWAPqlNDsagbrlJXydhYIdyg7wsdOU72k4DzmkFdkxnW+eda0
         Gp8+OZ8+a2vuF/2dW+fQgfFLmIjiJtIf9LjNxdBg=
X-UI-Sender-Class: 01bb95c1-4bf8-414a-932a-4f6e2808ef9c
Received: from Venus.fritz.box ([149.172.234.120]) by mail.gmx.net (mrgmx004
 [212.227.17.190]) with ESMTPSA (Nemesis) id 1MBDjA-1m0HSa0Xi2-00Cktx; Fri, 18
 Jun 2021 16:52:46 +0200
From:   Lino Sanfilippo <LinoSanfilippo@gmx.de>
To:     gregkh@linuxfoundation.org
Cc:     linux@armlinux.org.uk, jirislaby@kernel.org,
        linux-serial@vger.kernel.org, linux-kernel@vger.kernel.org,
        Lino Sanfilippo <LinoSanfilippo@gmx.de>
Subject: [PATCH v2] serial: amba-pl011: add RS485 support
Date:   Fri, 18 Jun 2021 16:51:53 +0200
Message-Id: <20210618145153.1906-1-LinoSanfilippo@gmx.de>
X-Mailer: git-send-email 2.31.1
MIME-Version: 1.0
Content-Transfer-Encoding: base64
X-Provags-ID: V03:K1:CB+ebwe0LaU4nsaqrxqhNQ+UJYl2zS7N5eKwzKvGEATKkoQVXMw
 hFlEzlNCJiHpDmh1g7EBmJu/TjZSaSQfTZ1YlCusP6DEZ28rs3P6xmYVoCbwyvmavdWJE3a
 bbADF8RRKTm5v7J5EbU/fv4dKh47GJEbiReZFu5GFRDfl7qg2/Upv35NP/yrCGDQ0h9uoVk
 wGpWV69yoLk3xQFPgV8DA==
X-Spam-Flag: NO
X-UI-Out-Filterresults: notjunk:1;V03:K0:yp5ZZtAgNTc=:NWNaVPC/JuUbpWa3ifh5Gu
 Go+9QcV9zy+BmSf/fPHMV+v8ufrVMdv90HwLuLPAxT83tZz9+Uu4SzHbqswiOCitYq7lnMNxp
 P6o+lysDPmIfn3JNJAo5opBppPCLIDjfdAFmT4THz7YpZ63rnb068WRWRE6FTkGcI9XsE7I8p
 OLw2ygWMKE2JmemwXTBql6A6Lyrv/yg/7CFXkjGX342tSd2D3i9jhYLmBvLyxPwDauIjkUANS
 GkAjZKN5SOulMsApFXGppH9ak2bazmYY4GDMDsi8V+QY+gFC40NOpr7NiJ2T+ZZYAAZ8RdQVX
 ayWcP4ucoQy5bxuunHFhJybo8rC69D4yN4Gab4o9NEqL6p3NzpVqtAZU+HvSAK2Nj6y3cg6Hv
 dxzNJYpGq3WmyR5kmLkV+u0xSqVCgZgrbTO5FcEZKYATDgYpVducrrJ58uuI77zWT2/BEO/RV
 FBAWIO36xAWFIWx9exzvMPo4nMfP7AsgxyCqUC8jqj7Z8B5OV3Tj7Shh2cCO4BxVsr4q7ViD3
 5RakTESCr5yeE8RERaObQXgjrYlhTHUcq5bVsHGz6YVArgJAORe2jZj+qRhJs0HePuridSTLG
 8cPU/BiGAuBhKe0p8CK9MgO7QZ0l15IYwU6gGHcEu7pFBU2G6P0Qu3DHLtHMu/DxaeKhWUW8Q
 uSV6a4keCpM5/V6HQB+E8bdOaXCSxwqNaf7Aqyh/iNvP1uca+AOcUha9kURZDLBUmFxxfM5Fl
 LSIoS8kE0CcZJTg8/y5/3CFlFBfIO26Y29WUTfTDXkXS2yYWnkaIKIfvJ7d0LPm5CW9ByGSFx
 X0vdRTEuYH6o6YHUPHrFsUyr47XXw4gjng8+WpvkhVOuSeuE0ZZZQuXqDCIqcqHeTGjOALIOF
 yp3/MivVPuHmRXf4druC9GsYwEQGWy41KIzo3zGAvhlQzuoxJFvZ61mMH7YwHrt57D4geiQ6H
 I/Ice5VLk2TNWuEoJmB+AYs+CUqk9Lqkm5AwId0d5Mnes52B3LZMgUXmG/05JC3bt31wygUZm
 1uHUWIV/SSouowSWrSHmprhuKwUAaMqG0zM2OodypFjrp9Tvt9geOaS1OUKtMQmHfw4+TfknP
 XJMu4IZBpIuYOxWbnr4iv+xryboSVOHdHJsjOdbdcXtMp9SZaroDVCquw==
Precedence: bulk
List-ID: <linux-serial.vger.kernel.org>
X-Mailing-List: linux-serial@vger.kernel.org

QWRkIGJhc2ljIHN1cHBvcnQgZm9yIFJTNDg1OiBQcm92aWRlIGEgY2FsbGJhY2sgdG8gY29uZmln
dXJlIFJTNDg1CnNldHRpbmdzLiBIYW5kbGUgdGhlIFJTNDg1IHNwZWNpZmljIHBhcnQgaW4gdGhl
IGZ1bmN0aW9ucwpwbDAxMV9yczQ4NV90eF9zdGFydCgpIGFuZCBwbDAxMV9yczQ4NV90eF9zdG9w
KCkgd2hpY2ggZXh0ZW5kIHRoZSBnZW5lcmljCnN0YXJ0L3N0b3AgY2FsbGJhY2tzLgpCZXNpZGUg
dmlhIElPQ1RMIGZyb20gdXNlcnNwYWNlIFJTNDg1IGNhbiBiZSBlbmFibGVkIGJ5IG1lYW5zIG9m
IHRoZQpkZXZpY2UgdHJlZSBwcm9wZXJ0eSAicnM0ODUtZW5hYmxlZC1hdC1ib290LXRpbWUiLgoK
U2lnbmVkLW9mZi1ieTogTGlubyBTYW5maWxpcHBvIDxMaW5vU2FuZmlsaXBwb0BnbXguZGU+Ci0t
LQpUaGlzIHBhdGNoIGFwcGxpZXMgYWdhaW5zdCBHcmVncyB0dHktdGVzdGluZyBicmFuY2ggYW5k
IHdhcyB0ZXN0ZWQgb24gYQpSYXNwYmVycnkgUGkgQ00zLgoKQ2hhbmdlcyBpbiBWMjoKLSBjbGFt
cCBSVFMgZGVsYXlzIHRvIDEwMG1zIGFzIHN1Z2dlc3RlZCBieSBKaXJpIFNsYWJ5Ci0gaW5zdGVh
ZCBvZiBjb3VudGluZyBiaXRzICJieSBoYW5kIiB1c2UgdGhlIG5ldyBmdW5jdGlvbiB0dHlfZ2V0
X2ZyYW1lX3NpemUoKQogIChhbHNvIHN1Z2dlc3RlZCBieSBKaXJpKQotIHVzZSB0aGUgdGVybSBS
UzQ4NSBjb25zaXN0ZW50bHkgaW4gdGhlIGNvbW1pdCBtZXNzYWdlCi0gcmVtb3ZlIG9uZSBibGFu
ayBsaW5lCgoKIGRyaXZlcnMvdHR5L3NlcmlhbC9hbWJhLXBsMDExLmMgfCAxNTIgKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKy0KIDEgZmlsZSBjaGFuZ2VkLCAxNTAgaW5zZXJ0aW9ucygr
KSwgMiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL3R0eS9zZXJpYWwvYW1iYS1w
bDAxMS5jIGIvZHJpdmVycy90dHkvc2VyaWFsL2FtYmEtcGwwMTEuYwppbmRleCBlMTRmMzM3OGI4
YTAuLjkyYzZiMDhkNTZmYiAxMDA2NDQKLS0tIGEvZHJpdmVycy90dHkvc2VyaWFsL2FtYmEtcGww
MTEuYworKysgYi9kcml2ZXJzL3R0eS9zZXJpYWwvYW1iYS1wbDAxMS5jCkBAIC0yNjUsNiArMjY1
LDggQEAgc3RydWN0IHVhcnRfYW1iYV9wb3J0IHsKIAl1bnNpZ25lZCBpbnQJCW9sZF9jcjsJCS8q
IHN0YXRlIGR1cmluZyBzaHV0ZG93biAqLwogCXVuc2lnbmVkIGludAkJZml4ZWRfYmF1ZDsJLyog
dmVuZG9yLXNldCBmaXhlZCBiYXVkIHJhdGUgKi8KIAljaGFyCQkJdHlwZVsxMl07CisJYm9vbAkJ
CXJzNDg1X3R4X3N0YXJ0ZWQ7CisJdW5zaWduZWQgaW50CQlyczQ4NV90eF9kcmFpbl9pbnRlcnZh
bDsgLyogdXNlY3MgKi8KICNpZmRlZiBDT05GSUdfRE1BX0VOR0lORQogCS8qIERNQSBzdHVmZiAq
LwogCWJvb2wJCQl1c2luZ190eF9kbWE7CkBAIC0yNzUsNiArMjc3LDggQEAgc3RydWN0IHVhcnRf
YW1iYV9wb3J0IHsKICNlbmRpZgogfTsKIAorc3RhdGljIHVuc2lnbmVkIGludCBwbDAxMV90eF9l
bXB0eShzdHJ1Y3QgdWFydF9wb3J0ICpwb3J0KTsKKwogc3RhdGljIHVuc2lnbmVkIGludCBwbDAx
MV9yZWdfdG9fb2Zmc2V0KGNvbnN0IHN0cnVjdCB1YXJ0X2FtYmFfcG9ydCAqdWFwLAogCXVuc2ln
bmVkIGludCByZWcpCiB7CkBAIC0xMjgyLDYgKzEyODYsMzQgQEAgc3RhdGljIGlubGluZSBib29s
IHBsMDExX2RtYV9yeF9ydW5uaW5nKHN0cnVjdCB1YXJ0X2FtYmFfcG9ydCAqdWFwKQogI2RlZmlu
ZSBwbDAxMV9kbWFfZmx1c2hfYnVmZmVyCU5VTEwKICNlbmRpZgogCitzdGF0aWMgaW50IHBsMDEx
X3JzNDg1X3R4X3N0b3Aoc3RydWN0IHVhcnRfYW1iYV9wb3J0ICp1YXApCit7CisJc3RydWN0IHVh
cnRfcG9ydCAqcG9ydCA9ICZ1YXAtPnBvcnQ7CisJdTMyIGNyOworCisJLyogV2FpdCB1bnRpbCBo
YXJkd2FyZSB0eCBxdWV1ZSBpcyBlbXB0eSAqLworCXdoaWxlICghcGwwMTFfdHhfZW1wdHkocG9y
dCkpCisJCXVkZWxheSh1YXAtPnJzNDg1X3R4X2RyYWluX2ludGVydmFsKTsKKworCWlmIChwb3J0
LT5yczQ4NS5kZWxheV9ydHNfYWZ0ZXJfc2VuZCkKKwkJbWRlbGF5KHBvcnQtPnJzNDg1LmRlbGF5
X3J0c19hZnRlcl9zZW5kKTsKKworCWNyID0gcGwwMTFfcmVhZCh1YXAsIFJFR19DUik7CisKKwlp
ZiAocG9ydC0+cnM0ODUuZmxhZ3MgJiBTRVJfUlM0ODVfUlRTX0FGVEVSX1NFTkQpCisJCWNyICY9
IH5VQVJUMDExX0NSX1JUUzsKKwllbHNlCisJCWNyIHw9IFVBUlQwMTFfQ1JfUlRTOworCS8qIERp
c2FibGUgdGhlIHRyYW5zbWl0dGVyIGFuZCByZWVuYWJsZSB0aGUgdHJhbnNjZWl2ZXIgKi8KKwlj
ciAmPSB+VUFSVDAxMV9DUl9UWEU7CisJY3IgfD0gVUFSVDAxMV9DUl9SWEU7CisJcGwwMTFfd3Jp
dGUoY3IsIHVhcCwgUkVHX0NSKTsKKworCXVhcC0+cnM0ODVfdHhfc3RhcnRlZCA9IGZhbHNlOwor
CisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyB2b2lkIHBsMDExX3N0b3BfdHgoc3RydWN0IHVhcnRf
cG9ydCAqcG9ydCkKIHsKIAlzdHJ1Y3QgdWFydF9hbWJhX3BvcnQgKnVhcCA9CkBAIC0xMjkwLDYg
KzEzMjIsOSBAQCBzdGF0aWMgdm9pZCBwbDAxMV9zdG9wX3R4KHN0cnVjdCB1YXJ0X3BvcnQgKnBv
cnQpCiAJdWFwLT5pbSAmPSB+VUFSVDAxMV9UWElNOwogCXBsMDExX3dyaXRlKHVhcC0+aW0sIHVh
cCwgUkVHX0lNU0MpOwogCXBsMDExX2RtYV90eF9zdG9wKHVhcCk7CisKKwlpZiAoKHBvcnQtPnJz
NDg1LmZsYWdzICYgU0VSX1JTNDg1X0VOQUJMRUQpICYmIHVhcC0+cnM0ODVfdHhfc3RhcnRlZCkK
KwkJcGwwMTFfcnM0ODVfdHhfc3RvcCh1YXApOwogfQogCiBzdGF0aWMgYm9vbCBwbDAxMV90eF9j
aGFycyhzdHJ1Y3QgdWFydF9hbWJhX3BvcnQgKnVhcCwgYm9vbCBmcm9tX2lycSk7CkBAIC0xMzgw
LDYgKzE0MTUsMzEgQEAgc3RhdGljIGJvb2wgcGwwMTFfdHhfY2hhcihzdHJ1Y3QgdWFydF9hbWJh
X3BvcnQgKnVhcCwgdW5zaWduZWQgY2hhciBjLAogCXJldHVybiB0cnVlOwogfQogCitzdGF0aWMg
dm9pZCBwbDAxMV9yczQ4NV90eF9zdGFydChzdHJ1Y3QgdWFydF9hbWJhX3BvcnQgKnVhcCkKK3sK
KwlzdHJ1Y3QgdWFydF9wb3J0ICpwb3J0ID0gJnVhcC0+cG9ydDsKKwl1MzIgY3I7CisKKwkvKiBF
bmFibGUgdHJhbnNtaXR0ZXIgKi8KKwljciA9IHBsMDExX3JlYWQodWFwLCBSRUdfQ1IpOworCWNy
IHw9IFVBUlQwMTFfQ1JfVFhFOworCS8qIERpc2FibGUgcmVjZWl2ZXIgaWYgaGFsZi1kdXBsZXgg
Ki8KKwlpZiAoIShwb3J0LT5yczQ4NS5mbGFncyAmIFNFUl9SUzQ4NV9SWF9EVVJJTkdfVFgpKQor
CQljciAmPSB+VUFSVDAxMV9DUl9SWEU7CisKKwlpZiAocG9ydC0+cnM0ODUuZmxhZ3MgJiBTRVJf
UlM0ODVfUlRTX09OX1NFTkQpCisJCWNyICY9IH5VQVJUMDExX0NSX1JUUzsKKwllbHNlCisJCWNy
IHw9IFVBUlQwMTFfQ1JfUlRTOworCisJcGwwMTFfd3JpdGUoY3IsIHVhcCwgUkVHX0NSKTsKKwor
CWlmIChwb3J0LT5yczQ4NS5kZWxheV9ydHNfYmVmb3JlX3NlbmQpCisJCW1kZWxheShwb3J0LT5y
czQ4NS5kZWxheV9ydHNfYmVmb3JlX3NlbmQpOworCisJdWFwLT5yczQ4NV90eF9zdGFydGVkID0g
dHJ1ZTsKK30KKwogLyogUmV0dXJucyB0cnVlIGlmIHR4IGludGVycnVwdHMgaGF2ZSB0byBiZSAo
a2VwdCkgZW5hYmxlZCAgKi8KIHN0YXRpYyBib29sIHBsMDExX3R4X2NoYXJzKHN0cnVjdCB1YXJ0
X2FtYmFfcG9ydCAqdWFwLCBib29sIGZyb21faXJxKQogewpAQCAtMTM5Nyw2ICsxNDU3LDEwIEBA
IHN0YXRpYyBib29sIHBsMDExX3R4X2NoYXJzKHN0cnVjdCB1YXJ0X2FtYmFfcG9ydCAqdWFwLCBi
b29sIGZyb21faXJxKQogCQlyZXR1cm4gZmFsc2U7CiAJfQogCisJaWYgKCh1YXAtPnBvcnQucnM0
ODUuZmxhZ3MgJiBTRVJfUlM0ODVfRU5BQkxFRCkgJiYKKwkgICAgIXVhcC0+cnM0ODVfdHhfc3Rh
cnRlZCkKKwkJcGwwMTFfcnM0ODVfdHhfc3RhcnQodWFwKTsKKwogCS8qIElmIHdlIGFyZSB1c2lu
ZyBETUEgbW9kZSwgdHJ5IHRvIHNlbmQgc29tZSBjaGFyYWN0ZXJzLiAqLwogCWlmIChwbDAxMV9k
bWFfdHhfaXJxKHVhcCkpCiAJCXJldHVybiB0cnVlOwpAQCAtMTU0Miw2ICsxNjA2LDkgQEAgc3Rh
dGljIHZvaWQgcGwwMTFfc2V0X21jdHJsKHN0cnVjdCB1YXJ0X3BvcnQgKnBvcnQsIHVuc2lnbmVk
IGludCBtY3RybCkKIAkgICAgY29udGFpbmVyX29mKHBvcnQsIHN0cnVjdCB1YXJ0X2FtYmFfcG9y
dCwgcG9ydCk7CiAJdW5zaWduZWQgaW50IGNyOwogCisJaWYgKHBvcnQtPnJzNDg1LmZsYWdzICYg
U0VSX1JTNDg1X0VOQUJMRUQpCisJCW1jdHJsICY9IH5USU9DTV9SVFM7CisKIAljciA9IHBsMDEx
X3JlYWQodWFwLCBSRUdfQ1IpOwogCiAjZGVmaW5lCVRJT0NNQklUKHRpb2NtYml0LCB1YXJ0Yml0
KQkJXApAQCAtMTc2Myw3ICsxODMwLDE3IEBAIHN0YXRpYyBpbnQgcGwwMTFfc3RhcnR1cChzdHJ1
Y3QgdWFydF9wb3J0ICpwb3J0KQogCiAJLyogcmVzdG9yZSBSVFMgYW5kIERUUiAqLwogCWNyID0g
dWFwLT5vbGRfY3IgJiAoVUFSVDAxMV9DUl9SVFMgfCBVQVJUMDExX0NSX0RUUik7Ci0JY3IgfD0g
VUFSVDAxeF9DUl9VQVJURU4gfCBVQVJUMDExX0NSX1JYRSB8IFVBUlQwMTFfQ1JfVFhFOworCWNy
IHw9IFVBUlQwMXhfQ1JfVUFSVEVOIHwgVUFSVDAxMV9DUl9SWEU7CisKKwlpZiAocG9ydC0+cnM0
ODUuZmxhZ3MgJiBTRVJfUlM0ODVfRU5BQkxFRCkgeworCQlpZiAocG9ydC0+cnM0ODUuZmxhZ3Mg
JiBTRVJfUlM0ODVfUlRTX0FGVEVSX1NFTkQpCisJCQljciAmPSB+VUFSVDAxMV9DUl9SVFM7CisJ
CWVsc2UKKwkJCWNyIHw9IFVBUlQwMTFfQ1JfUlRTOworCX0gZWxzZSB7CisJCWNyIHw9IFVBUlQw
MTFfQ1JfVFhFOworCX0KKwogCXBsMDExX3dyaXRlKGNyLCB1YXAsIFJFR19DUik7CiAKIAlzcGlu
X3VubG9ja19pcnEoJnVhcC0+cG9ydC5sb2NrKTsKQEAgLTE4NjQsNiArMTk0MSw5IEBAIHN0YXRp
YyB2b2lkIHBsMDExX3NodXRkb3duKHN0cnVjdCB1YXJ0X3BvcnQgKnBvcnQpCiAKIAlwbDAxMV9k
bWFfc2h1dGRvd24odWFwKTsKIAorCWlmICgocG9ydC0+cnM0ODUuZmxhZ3MgJiBTRVJfUlM0ODVf
RU5BQkxFRCkgJiYgdWFwLT5yczQ4NV90eF9zdGFydGVkKQorCQlwbDAxMV9yczQ4NV90eF9zdG9w
KHVhcCk7CisKIAlmcmVlX2lycSh1YXAtPnBvcnQuaXJxLCB1YXApOwogCiAJcGwwMTFfZGlzYWJs
ZV91YXJ0KHVhcCk7CkBAIC0xOTQxLDYgKzIwMjEsNyBAQCBwbDAxMV9zZXRfdGVybWlvcyhzdHJ1
Y3QgdWFydF9wb3J0ICpwb3J0LCBzdHJ1Y3Qga3Rlcm1pb3MgKnRlcm1pb3MsCiAJdW5zaWduZWQg
aW50IGxjcl9oLCBvbGRfY3I7CiAJdW5zaWduZWQgbG9uZyBmbGFnczsKIAl1bnNpZ25lZCBpbnQg
YmF1ZCwgcXVvdCwgY2xrZGl2OworCXVuc2lnbmVkIGludCBiaXRzOwogCiAJaWYgKHVhcC0+dmVu
ZG9yLT5vdmVyc2FtcGxpbmcpCiAJCWNsa2RpdiA9IDg7CkBAIC0xOTkxLDE4ICsyMDcyLDI5IEBA
IHBsMDExX3NldF90ZXJtaW9zKHN0cnVjdCB1YXJ0X3BvcnQgKnBvcnQsIHN0cnVjdCBrdGVybWlv
cyAqdGVybWlvcywKIAlpZiAodWFwLT5maWZvc2l6ZSA+IDEpCiAJCWxjcl9oIHw9IFVBUlQwMXhf
TENSSF9GRU47CiAKKwliaXRzID0gdHR5X2dldF9mcmFtZV9zaXplKHRlcm1pb3MtPmNfY2ZsYWcp
OworCiAJc3Bpbl9sb2NrX2lycXNhdmUoJnBvcnQtPmxvY2ssIGZsYWdzKTsKIAogCS8qCiAJICog
VXBkYXRlIHRoZSBwZXItcG9ydCB0aW1lb3V0LgogCSAqLwogCXVhcnRfdXBkYXRlX3RpbWVvdXQo
cG9ydCwgdGVybWlvcy0+Y19jZmxhZywgYmF1ZCk7CisJLyoKKwkgKiBDYWxjdWxhdGUgdGhlIGFw
cHJveGltYXRlZCB0aW1lIGl0IHRha2VzIHRvIHRyYW5zbWl0IG9uZSBjaGFyYWN0ZXIKKwkgKiB3
aXRoIHRoZSBnaXZlbiBiYXVkIHJhdGUuIFdlIHVzZSB0aGlzIGFzIHRoZSBwb2xsIGludGVydmFs
IHdoZW4gd2UKKwkgKiB3YWl0IGZvciB0aGUgdHggcXVldWUgdG8gZW1wdHkuCisJICovCisJdWFw
LT5yczQ4NV90eF9kcmFpbl9pbnRlcnZhbCA9IChiaXRzICogMTAwMCAqIDEwMDApIC8gYmF1ZDsK
IAogCXBsMDExX3NldHVwX3N0YXR1c19tYXNrcyhwb3J0LCB0ZXJtaW9zKTsKIAogCWlmIChVQVJU
X0VOQUJMRV9NUyhwb3J0LCB0ZXJtaW9zLT5jX2NmbGFnKSkKIAkJcGwwMTFfZW5hYmxlX21zKHBv
cnQpOwogCisJaWYgKHBvcnQtPnJzNDg1LmZsYWdzICYgU0VSX1JTNDg1X0VOQUJMRUQpCisJCXRl
cm1pb3MtPmNfY2ZsYWcgJj0gfkNSVFNDVFM7CisKIAkvKiBmaXJzdCwgZGlzYWJsZSBldmVyeXRo
aW5nICovCiAJb2xkX2NyID0gcGwwMTFfcmVhZCh1YXAsIFJFR19DUik7CiAJcGwwMTFfd3JpdGUo
MCwgdWFwLCBSRUdfQ1IpOwpAQCAtMjEyNCw2ICsyMjE2LDQwIEBAIHN0YXRpYyBpbnQgcGwwMTFf
dmVyaWZ5X3BvcnQoc3RydWN0IHVhcnRfcG9ydCAqcG9ydCwgc3RydWN0IHNlcmlhbF9zdHJ1Y3Qg
KnNlcikKIAlyZXR1cm4gcmV0OwogfQogCitzdGF0aWMgaW50IHBsMDExX3JzNDg1X2NvbmZpZyhz
dHJ1Y3QgdWFydF9wb3J0ICpwb3J0LAorCQkJICAgICAgc3RydWN0IHNlcmlhbF9yczQ4NSAqcnM0
ODUpCit7CisJc3RydWN0IHVhcnRfYW1iYV9wb3J0ICp1YXAgPQorCQljb250YWluZXJfb2YocG9y
dCwgc3RydWN0IHVhcnRfYW1iYV9wb3J0LCBwb3J0KTsKKworCS8qIHBpY2sgc2FuZSBzZXR0aW5n
cyBpZiB0aGUgdXNlciBoYXNuJ3QgKi8KKwlpZiAoISEocnM0ODUtPmZsYWdzICYgU0VSX1JTNDg1
X1JUU19PTl9TRU5EKSA9PQorCSAgICAhIShyczQ4NS0+ZmxhZ3MgJiBTRVJfUlM0ODVfUlRTX0FG
VEVSX1NFTkQpKSB7CisJCXJzNDg1LT5mbGFncyB8PSBTRVJfUlM0ODVfUlRTX09OX1NFTkQ7CisJ
CXJzNDg1LT5mbGFncyAmPSB+U0VSX1JTNDg1X1JUU19BRlRFUl9TRU5EOworCX0KKwkvKiBjbGFt
cCB0aGUgZGVsYXlzIHRvIFswLCAxMDBtc10gKi8KKwlyczQ4NS0+ZGVsYXlfcnRzX2JlZm9yZV9z
ZW5kID0gbWluKHJzNDg1LT5kZWxheV9ydHNfYmVmb3JlX3NlbmQsIDEwMFUpOworCXJzNDg1LT5k
ZWxheV9ydHNfYWZ0ZXJfc2VuZCA9IG1pbihyczQ4NS0+ZGVsYXlfcnRzX2FmdGVyX3NlbmQsIDEw
MFUpOworCW1lbXNldChyczQ4NS0+cGFkZGluZywgMCwgc2l6ZW9mKHJzNDg1LT5wYWRkaW5nKSk7
CisKKwlpZiAocG9ydC0+cnM0ODUuZmxhZ3MgJiBTRVJfUlM0ODVfRU5BQkxFRCkKKwkJcGwwMTFf
cnM0ODVfdHhfc3RvcCh1YXApOworCisJLyogU2V0IG5ldyBjb25maWd1cmF0aW9uICovCisJcG9y
dC0+cnM0ODUgPSAqcnM0ODU7CisJLyogTWFrZSBzdXJlIGF1dG8gUlRTIGlzIGRpc2FibGVkICov
CisJaWYgKHBvcnQtPnJzNDg1LmZsYWdzICYgU0VSX1JTNDg1X0VOQUJMRUQpIHsKKwkJdTMyIGNy
ID0gcGwwMTFfcmVhZCh1YXAsIFJFR19DUik7CisKKwkJY3IgJj0gflVBUlQwMTFfQ1JfUlRTRU47
CisJCXBsMDExX3dyaXRlKGNyLCB1YXAsIFJFR19DUik7CisJCXBvcnQtPnN0YXR1cyAmPSB+VVBT
VEFUX0FVVE9SVFM7CisJfQorCisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBjb25zdCBzdHJ1Y3Qg
dWFydF9vcHMgYW1iYV9wbDAxMV9wb3BzID0gewogCS50eF9lbXB0eQk9IHBsMDExX3R4X2VtcHR5
LAogCS5zZXRfbWN0cmwJPSBwbDAxMV9zZXRfbWN0cmwsCkBAIC0yNTg4LDEwICsyNzE0LDI4IEBA
IHN0YXRpYyBpbnQgcGwwMTFfZmluZF9mcmVlX3BvcnQodm9pZCkKIAlyZXR1cm4gLUVCVVNZOwog
fQogCitzdGF0aWMgaW50IHBsMDExX2dldF9yczQ4NV9tb2RlKHN0cnVjdCB1YXJ0X2FtYmFfcG9y
dCAqdWFwKQoreworCXN0cnVjdCB1YXJ0X3BvcnQgKnBvcnQgPSAmdWFwLT5wb3J0OworCXN0cnVj
dCBzZXJpYWxfcnM0ODUgKnJzNDg1ID0gJnBvcnQtPnJzNDg1OworCWludCByZXQ7CisKKwlyZXQg
PSB1YXJ0X2dldF9yczQ4NV9tb2RlKHBvcnQpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisK
KwkvKiBjbGFtcCB0aGUgZGVsYXlzIHRvIFswLCAxMDBtc10gKi8KKwlyczQ4NS0+ZGVsYXlfcnRz
X2JlZm9yZV9zZW5kID0gbWluKHJzNDg1LT5kZWxheV9ydHNfYmVmb3JlX3NlbmQsIDEwMFUpOwor
CXJzNDg1LT5kZWxheV9ydHNfYWZ0ZXJfc2VuZCA9IG1pbihyczQ4NS0+ZGVsYXlfcnRzX2FmdGVy
X3NlbmQsIDEwMFUpOworCisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBpbnQgcGwwMTFfc2V0dXBf
cG9ydChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCB1YXJ0X2FtYmFfcG9ydCAqdWFwLAogCQkJ
ICAgIHN0cnVjdCByZXNvdXJjZSAqbW1pb2Jhc2UsIGludCBpbmRleCkKIHsKIAl2b2lkIF9faW9t
ZW0gKmJhc2U7CisJaW50IHJldDsKIAogCWJhc2UgPSBkZXZtX2lvcmVtYXBfcmVzb3VyY2UoZGV2
LCBtbWlvYmFzZSk7CiAJaWYgKElTX0VSUihiYXNlKSkKQEAgLTI2MDgsNiArMjc1MiwxMCBAQCBz
dGF0aWMgaW50IHBsMDExX3NldHVwX3BvcnQoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgdWFy
dF9hbWJhX3BvcnQgKnVhcCwKIAl1YXAtPnBvcnQuZmxhZ3MgPSBVUEZfQk9PVF9BVVRPQ09ORjsK
IAl1YXAtPnBvcnQubGluZSA9IGluZGV4OwogCisJcmV0ID0gcGwwMTFfZ2V0X3JzNDg1X21vZGUo
dWFwKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCiAJYW1iYV9wb3J0c1tpbmRleF0gPSB1
YXA7CiAKIAlyZXR1cm4gMDsKQEAgLTI2NjUsNyArMjgxMyw3IEBAIHN0YXRpYyBpbnQgcGwwMTFf
cHJvYmUoc3RydWN0IGFtYmFfZGV2aWNlICpkZXYsIGNvbnN0IHN0cnVjdCBhbWJhX2lkICppZCkK
IAl1YXAtPnBvcnQuaW90eXBlID0gdmVuZG9yLT5hY2Nlc3NfMzJiID8gVVBJT19NRU0zMiA6IFVQ
SU9fTUVNOwogCXVhcC0+cG9ydC5pcnEgPSBkZXYtPmlycVswXTsKIAl1YXAtPnBvcnQub3BzID0g
JmFtYmFfcGwwMTFfcG9wczsKLQorCXVhcC0+cG9ydC5yczQ4NV9jb25maWcgPSBwbDAxMV9yczQ4
NV9jb25maWc7CiAJc25wcmludGYodWFwLT50eXBlLCBzaXplb2YodWFwLT50eXBlKSwgIlBMMDEx
IHJldiV1IiwgYW1iYV9yZXYoZGV2KSk7CiAKIAlyZXQgPSBwbDAxMV9zZXR1cF9wb3J0KCZkZXYt
PmRldiwgdWFwLCAmZGV2LT5yZXMsIHBvcnRucik7CgpiYXNlLWNvbW1pdDogYjYxYzhiZjQ2OTRi
NTExNTc2Njg0OTM3OGRjYjg3ODdmZjU0ZTY1ZQotLSAKMi4zMS4xCgo=
